{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Vulnerability Scanner Output",
  "description": "Output schema for the vulnerability detection block",
  "type": "object",
  "properties": {
    "vulnerabilities": {
      "type": "array",
      "description": "List of detected security vulnerabilities",
      "items": {
        "type": "object",
        "properties": {
          "file_path": {
            "type": "string",
            "description": "Path to the vulnerable file"
          },
          "vulnerability_type": {
            "type": "string",
            "enum": [
              "SQL_INJECTION",
              "NOSQL_INJECTION", 
              "CODE_INJECTION",
              "COMMAND_INJECTION",
              "XSS",
              "CSRF",
              "AUTHENTICATION_BYPASS",
              "AUTHORIZATION_FAILURE",
              "INFORMATION_DISCLOSURE",
              "HARDCODED_CREDENTIALS",
              "INSECURE_DESERIALIZATION",
              "PATH_TRAVERSAL",
              "WEAK_CRYPTOGRAPHY",
              "INSECURE_CONFIGURATION",
              "INPUT_VALIDATION_FAILURE",
              "SESSION_MANAGEMENT_FLAW",
              "PRIVILEGE_ESCALATION",
              "BUFFER_OVERFLOW",
              "RACE_CONDITION",
              "OTHER"
            ],
            "description": "Type of vulnerability detected"
          },
          "severity": {
            "type": "string",
            "enum": ["CRITICAL", "HIGH", "MEDIUM", "LOW"],
            "description": "Severity level of the vulnerability"
          },
          "description": {
            "type": "string",
            "description": "Detailed description of the vulnerability"
          },
          "vulnerable_code": {
            "type": "string",
            "description": "The actual vulnerable code snippet"
          },
          "line_reference": {
            "type": "string",
            "description": "Line number or range where vulnerability exists"
          },
          "cwe_id": {
            "type": "string",
            "pattern": "^CWE-[0-9]+$",
            "description": "Common Weakness Enumeration identifier"
          },
          "cvss_score": {
            "type": "number",
            "minimum": 0.0,
            "maximum": 10.0,
            "description": "CVSS base score (0.0-10.0)"
          },
          "impact": {
            "type": "string",
            "description": "Potential impact if exploited"
          },
          "exploitability": {
            "type": "string",
            "enum": ["EASY", "MEDIUM", "HARD"],
            "description": "How easy it is to exploit this vulnerability"
          },
          "proof_of_concept": {
            "type": "string",
            "description": "Example of how to exploit (if applicable)"
          },
          "references": {
            "type": "array",
            "description": "External references and resources",
            "items": {
              "type": "string",
              "format": "uri"
            }
          }
        },
        "required": [
          "file_path",
          "vulnerability_type", 
          "severity",
          "description",
          "vulnerable_code",
          "line_reference",
          "cwe_id"
        ]
      }
    },
    "summary": {
      "type": "object",
      "description": "Summary of vulnerability scan results",
      "properties": {
        "total_vulnerabilities": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of vulnerabilities found"
        },
        "critical": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of critical severity vulnerabilities"
        },
        "high": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of high severity vulnerabilities"
        },
        "medium": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of medium severity vulnerabilities"
        },
        "low": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of low severity vulnerabilities"
        },
        "files_scanned": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of files analyzed"
        },
        "vulnerable_files": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of files containing vulnerabilities"
        },
        "scan_timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "When the scan was performed"
        },
        "most_common_vulnerability": {
          "type": "string",
          "description": "Most frequently found vulnerability type"
        },
        "risk_score": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 10.0,
          "description": "Overall risk score for the repository"
        }
      },
      "required": [
        "total_vulnerabilities",
        "critical",
        "high", 
        "medium",
        "low",
        "files_scanned",
        "vulnerable_files"
      ]
    },
    "scan_metadata": {
      "type": "object",
      "description": "Metadata about the scanning process",
      "properties": {
        "scanner_version": {
          "type": "string",
          "description": "Version of the vulnerability scanner"
        },
        "scan_duration_ms": {
          "type": "integer",
          "minimum": 0,
          "description": "Time taken to complete scan in milliseconds"
        },
        "patterns_matched": {
          "type": "array",
          "description": "List of vulnerability patterns that were checked",
          "items": {
            "type": "string"
          }
        },
        "false_positive_likelihood": {
          "type": "string",
          "enum": ["LOW", "MEDIUM", "HIGH"],
          "description": "Estimated likelihood of false positives"
        }
      }
    }
  },
  "required": ["vulnerabilities", "summary"]
}
